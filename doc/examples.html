<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
<title>LuaJava - A Script Tool for Java</title>
<style type="text/css">
ul { list-style-type: disc };
</style>
</head>

<body bgcolor="#FFFFFF">

<hr>

<center>
<table border=0 cellspacing=0 cellpadding=0>
<tr><td align="center">
<a href="http://www.keplerproject.org/luajava">
<img border=0 alt="LuaJava" src="luajava_128.png">
</a>
<tr><td align="center" valign="top">A Script Tool for Java</td></tr>
</table>
</center>

<p align="center">
<a href="index.html">home</a> &middot;
<a href="index.html#whatis">what is</a> &middot;
<a href="index.html#down">download</a> &middot;
<a href="installation.html">installation</a> &middot;
<a href="manual.html">manual</a> &middot;
<a href="api/index.html">API</a> &middot;
<a href="examples.html">examples</a> &middot;
<a href="index.html#contact">contact</a>
<p>

<hr>

<h2>Examples :</h2>

<h4>Hello World using LuaJava</h4>

<p>This example is a simple Hello World application using LuaJava printing both from Lua and Java.</p>

Hello.java

<blockquote>
<code>
<pre>
public class Hello
{
  public static void main(String[] args)
  {
    LuaState L = LuaStateFactory.newLuaState();
    L.openBasicLibraries();
    
    L.doFile("hello.lua");
    
    System.out.println("Hello World from Java!");
  }
}
</pre>
</code>
</blockquote>

hello.lua

<blockquote>
<code>
<pre>
print("Hello World from Lua!")
</pre>
</code>
</blockquote>

<br/>
<h4>Example accessing a DataBase</h4>

<p>This example uses Java JDBC to access a database from Lua.</p>

TestJDBC.java

<blockquote>
<code>
<pre>
public class TestJDBC
{
  
  public static void main(String[] args) throws Exception
  {
    // gets a java.sql.Connection and creates a Statement

    Class.forName("org.hsqldb.jdbcDriver");
    Connection con = DriverManager.getConnection("jdbc:hsqldb:hsql://localhost:9002","sa","");
    Statement st = con.createStatement();
    
    try
    {
      st.execute("DROP TABLE luatest");
    }
    catch (Exception ignore) {}
    
    st.execute("CREATE TABLE luatest (id int not null primary key, str varchar, number double)");
    
    for(int i = 0 ; i &lt; 10 ; i++)
    {
      st.executeUpdate("INSERT INTO luatest (id, str, number) values(" + i + ", '" + 2*i + "', " + System.currentTimeMillis() + ")");
    }
    
    // creates a Lua State and register the basic libraries
    
    LuaState L = LuaStateFactory.newLuaState();
    L.openBasicLibraries();
    
    // registers the statement in the global 'st'
    
    L.pushString("st");
    L.pushObjectValue(st);
    L.setGlobal();
    
    // execute file testJDBC.lua
    
    int err = L.doFile("testJDBC.lua");

    L.close();
    st.close();
    con.close();
  }
}
</pre>
</code>
</blockquote>

testJDBC.lua

<blockquote>
<code>
<pre>
do
-- tests if object Statement is nil
if st == nil then
    print("Error. st object is nil")
    return
end

local st = st
_G.st = nil

function createSQLProxy(t)

    local tableName = t
    
    local function i (t,k)
    
        local id = tonumber(k)
        if not id then
            return nil
        end
        
        local function mi (t,k)
        
            local sql = "select "..k.." from "..tableName.." where id="..id
            local rs = st:executeQuery(sql)
            if not rs:next() then
                rs:close()
                return nil
            end
            
            local res = rs:getString(1)
            rs:close()
            
            return res
        end
        
        local res = {}
        setmetatable(res, {__index = mi})
        return res
    end
    
    local res = {}
    setmetatable(res, {__index = i })
    return res
end

end


proxy = createSQLProxy("luatest")

print(proxy[1].str)
print(proxy[1].number)


</pre>
</code>
</blockquote>

<hr>
<p align="center">
<a href="index.html">home</a> &middot;
<a href="index.html#whatis">what is</a> &middot;
<a href="index.html#down">download</a> &middot;
<a href="installation.html">installation</a> &middot;
<a href="manual.html">manual</a> &middot;
<a href="api/index.html">API</a> &middot;
<a href="examples.html">examples</a> &middot;
<a href="index.html#contact">contact</a>
<p>

</body>
</html>
