<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
	<title>LuaJava - A Script Tool for Java</title>
    <link rel="stylesheet" href="http://www.keplerproject.org/doc.css" type="text/css"/>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>

<body>

<div id="container">

<div id="product">
	<div id="product_logo"><a href="http://www.keplerproject.org/luajava/">
		<img alt="LuaJava" src="luajava_128.png"/>
	</a></div>
	<div id="product_name"><big><b>LuaJava</b></big></div>
	<div id="product_description">A Script Tool for Java</div>
</div> <!-- id="product" -->

<div id="main">
<div id="navigation">
	
<h1>LuaJava</h1>
	<ul>
		<li><a href="index.html">Home</a>
			<ul>
				<li><a href="index.html#whatis">What is</a></li>
				<li><a href="index.html#status">Status</a></li>
				<li><a href="index.html#download">Download</a></li>
				<li><a href="index.html#credits">Credits</a></li>
				<li><a href="index.html#contact">Contact us</a></li>
			</ul>
		</li>
		<li><a href="installation.html">Installation</a>
			<ul>
				<li><a href="installation.html#windows">Windows</a></li>
				<li><a href="installation.html#linux">Linux</a></li>
			</ul>	
		</li>
		<li><a href="manual.html">Manual</a>
			<ul>
				<li><a href="manual.html#tool">The LuaJava tool</a></li>
				<li><a href="manual.html#fromjava">Use from Java</a></li>
			</ul>
		</li>
		<li><strong>Examples</strong></li>
		<li><a href="API/index.html">API</a></li>
		<li><a href="license.html">License</a></li>
	</ul>
</div> <!-- id="navigation" -->

<div id="content">

<h2>Examples</h2>

<h4>Hello World using LuaJava</h4>

<p>This example is a simple Hello World application using LuaJava printing both from Lua and Java.</p>

<p>Hello.java</p>
<pre class="example">public class Hello
{
  public static void main(String[] args)
  {
    LuaState L = LuaStateFactory.newLuaState();
    L.openBasicLibraries();
    
    L.doFile("hello.lua");
    
    System.out.println("Hello World from Java!");
  }
}
</pre>

<p>hello.lua</p>

<pre class="example">print("Hello World from Lua!")
</pre>

<h4>Accessing a DataBase</h4>

<p>This example uses Java JDBC to access a database from Lua.</p>

<p>TestJDBC.java</p>

<pre class="example">public class TestJDBC
{
  
  public static void main(String[] args) throws Exception
  {
    // gets a java.sql.Connection and creates a Statement

    Class.forName("org.hsqldb.jdbcDriver");
    Connection con = DriverManager.getConnection(
	                    "jdbc:hsqldb:hsql://localhost:9002",
	                    "sa", "");
    Statement st = con.createStatement();
    
    try
    {
      st.execute("DROP TABLE luatest");
    }
    catch (Exception ignore) {}
    
    st.execute([[CREATE TABLE luatest 
               (id int not null primary key, 
               str varchar, number double)]]);
    
    for(int i = 0 ; i &lt; 10 ; i++)
    {
      st.executeUpdate(
          "INSERT INTO luatest (id, str, number) values(" + 
          i + ", '" + 2*i + "', " + 
          System.currentTimeMillis() + ")");
    }
    
    // creates a Lua State and register the basic libraries
    
    LuaState L = LuaStateFactory.newLuaState();
    L.openBasicLibraries();
    
    // registers the statement in the global 'st'
    
    L.pushString("st");
    L.pushObjectValue(st);
    L.setGlobal();
    
    // execute file testJDBC.lua
    
    int err = L.doFile("testJDBC.lua");

    L.close();
    st.close();
    con.close();
  }
}
</pre>

testJDBC.lua

<pre class="example">do
-- tests if object Statement is nil
if st == nil then
    print("Error. st object is nil")
    return
end

local st = st
_G.st = nil

function createSQLProxy(t)

    local tableName = t
    
    local function i (t,k)
    
        local id = tonumber(k)
        if not id then
            return nil
        end
        
        local function mi (t,k)
        
            local sql = "select "..k.." from "..
                        tableName.." where id="..id
            local rs = st:executeQuery(sql)
            if not rs:next() then
                rs:close()
                return nil
            end
            
            local res = rs:getString(1)
            rs:close()
            
            return res
        end
        
        local res = {}
        setmetatable(res, {__index = mi})
        return res
    end
    
    local res = {}
    setmetatable(res, {__index = i })
    return res
end

end


proxy = createSQLProxy("luatest")

print(proxy[1].str)
print(proxy[1].number)

</pre>

</div> <!-- id="content" -->

</div> <!-- id="main" -->


<div id="about">
	<p><a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!" height="31" width="88" /></a></p>
</div> <!-- id="about" -->

</div> <!-- id="container" -->

</body>
</html> 
